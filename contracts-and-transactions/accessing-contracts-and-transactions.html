

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>访问合约和交易 &mdash; 以太坊Homestead文档 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="author" title="About these documents"
              href="../about.html"/>
    <link rel="top" title="以太坊Homestead文档 0.1 documentation" href="../index.html"/>
        <link rel="up" title="合约和交易" href="index.html"/>
        <link rel="next" title="Mix" href="mix.html"/>
        <link rel="prev" title="合约" href="contracts.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> 以太坊Homestead文档
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">引言</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ethereum-clients/index.html">以太坊客户端</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connecting-to-clients/index.html">连接到以太坊客户端</a></li>
<li class="toctree-l1"><a class="reference internal" href="../account-management.html">账户管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ether.html">以太币</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/index.html">以太坊网络</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mining.html">挖矿</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">合约和交易</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="account-types-gas-and-transactions.html">账户类型、气和交易</a></li>
<li class="toctree-l2"><a class="reference internal" href="contracts.html">合约</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">访问合约和交易</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rpc">RPC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">公约</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">发布合约</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">与智能合约交互</a></li>
<li class="toctree-l3"><a class="reference internal" href="#web3-js">Web3.js</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">控制台</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">查看合约和交易</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#blockchain-explorers">托管的区块链浏览器</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">其他资源</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mix.html">Mix</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer-tools.html">Dapps</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer-tools.html#id3">开发工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethereum-tests/index.html">Ethereum Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="web3-base-layer-services.html">Web3基础层服务</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../frequently-asked-questions/frequently-asked-questions.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">术语表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">Homestead文档计划</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">以太坊Homestead文档</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">合约和交易</a> &raquo;</li>
      
    <li>访问合约和交易</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/contracts-and-transactions/accessing-contracts-and-transactions.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="accessing-contracts-and-transactions">
<span id="id1"></span><h1>访问合约和交易<a class="headerlink" href="#accessing-contracts-and-transactions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="rpc">
<h2>RPC<a class="headerlink" href="#rpc" title="Permalink to this headline">¶</a></h2>
<p>前边几节我们已经看到合约是如何写成、发布和交互的，现在该深入一些关于以太坊网络和智能合约间通信的细节了。</p>
<p>一个以太坊节点提供一个 <a class="reference external" href="https://wikipedia.org/wiki/Remote_procedure_call">RPC</a> 接口。这个接口允许Ðapp访问以太坊网络和节点提供的功能，比如编译智能合约代码。它使用 <a class="reference external" href="http://www.jsonrpc.org/specification">JSON-RPC 2.0</a> 规范的一个子集（不支持通知或命名参数）作为序列化协议，通过HTTP和IPC协议（在Linux/OSX上是unix domain socket，在Windows上是named pipes）实现。</p>
<p>如果你对细节不感兴趣，但在寻找一种简单的使用javascript的库，那你可以跳过下边的内容，直接参考 <a class="reference internal" href="#using-web3-js"><span>使用Web3</span></a> 。</p>
</div>
<div class="section" id="id3">
<h2>公约<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>PRC接口使用了一些不在JSON-RPC 2.0规范中的公约：</p>
<ul class="simple">
<li>数字需要使用16进制。做这个决定是因为一些语言没有、或者缺乏操作非常大的数字的支持。为了避免这种类型的错误，开发者需要对数字做出正确的处理。请以wiki上的 <a class="reference external" href="https://github.com/ethereum/wiki/wiki/JSON-RPC#output-hex-values">16进制编码</a> 为参考。</li>
<li>默认的区块号。很多RPC方法可以接受区块号。但某些情况下，区块号无法被确定或者不容易被确定。在这些情况下，默认的区块号可以是以下几个字符串之一【“earliest”、“latest”、“pending”】。请参考 <a class="reference external" href="https://github.com/ethereum/wiki/wiki/JSON-RPC#the-default-block-parameter">wiki页</a> 获知使用了默认区块号参数的RPC方法。</li>
</ul>
</div>
<div class="section" id="id5">
<h2>发布合约<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>我们来看一下仅使用RPC接口来发布下述合约的步骤。</p>
<div class="code js highlight-python"><div class="highlight"><pre>contract Multiply7 {
   event Print(uint);
   function multiply(uint input) returns (uint) {
      Print(input * 7);
      return input * 7;
   }
}
</pre></div>
</div>
<p>首先需要确认HTTP RPC接口是有效的。就是说我们用 <code class="docutils literal"><span class="pre">--rpc</span></code> 参数启动geth，或者用 <code class="docutils literal"><span class="pre">-j</span></code> 参数启动eth。在这个例子里，我们在一个私有开发链上使用geth节点，用这种方式，我们不需要真实的以太币。</p>
<div class="code bash highlight-python"><div class="highlight"><pre>&gt; geth --rpc --dev --mine --minerthreads 1 --unlock 0 console 2&gt;&gt;geth.log
</pre></div>
</div>
<p>这会在 <code class="docutils literal"><span class="pre">http://localhost:8545</span></code> 启动一个HTTP RPC接口。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">geth是支持 <a class="reference external" href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> 的。请参考 <code class="docutils literal"><span class="pre">--rpccorsdomain</span></code> 参数。</p>
</div>
<p>我们可以通过使用 <a class="reference external" href="https://curl.haxx.se/download.html">curl</a> 获取coinbase地址来验证接口是否在运行。请注意这里使用的数据会与你本地节点有所不同，如果你想尝试这些命令，请相应修改请求参数。</p>
<div class="code bash highlight-python"><div class="highlight"><pre>&gt; curl --data &#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;eth_coinbase&quot;, &quot;id&quot;:1}&#39; localhost:8545
{&quot;id&quot;:1,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:[&quot;0xeb85a5557e5bdc18ee1934a89d8bb402398ee26a&quot;]}

&gt; curl --data &#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;eth_getBalance&quot;, &quot;params&quot;: [&quot;0xeb85a5557e5bdc18ee1934a89d8bb402398ee26a&quot;], &quot;id&quot;:2}&#39; localhost:8545
{&quot;id&quot;:2,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:&quot;0x1639e49bba16280000&quot;}
</pre></div>
</div>
<p>记得我们已经说过数字需要被变换为16进制吧？在这里返回的余额是由16进制表示的wei的数量。如果我们希望获得以太币单位的余额，我们可以在geth控制台使用web3。</p>
<div class="code js highlight-python"><div class="highlight"><pre>&gt; web3.fromWei(&quot;0x1639e49bba16280000&quot;, &quot;ether&quot;)
&quot;410&quot;
</pre></div>
</div>
<p>现在我们在私有开发链上有了一些以太币，我们可以发布合约了。第一步是验证Solidity编译器可用。我们可以使用 <code class="docutils literal"><span class="pre">eth_getCompilers</span></code> 这个RPC方法查询可用的编译器。</p>
<div class="code bash highlight-python"><div class="highlight"><pre>&gt; curl --data &#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;: &quot;eth_getCompilers&quot;, &quot;id&quot;: 3}&#39; localhost:8545
{&quot;id&quot;:3,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:[&quot;Solidity&quot;]}
</pre></div>
</div>
<p>我们看到Solidity编译器是可用的。如果它不可用，请参考 <a class="reference external" href="http://solidity.readthedocs.org/en/latest/installing-solidity.html">安装Solidity</a> 。</p>
<p>下一步就是把Multiply7合约编译为可以发动到EVM的字节码。</p>
<div class="code bash highlight-python"><div class="highlight"><pre>&gt; curl --data &#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;: &quot;eth_compileSolidity&quot;, &quot;params&quot;: [&quot;contract Multiply7 { event Print(uint); function multiply(uint input) returns (uint) { Print(input * 7); return input * 7; } }&quot;], &quot;id&quot;: 4}&#39; localhost:8545
{&quot;id&quot;:4,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:{&quot;Multiply7&quot;:{&quot;code&quot;:&quot;0x6060604052605f8060106000396000f3606060405260e060020a6000350463c6888fa18114601a575b005b60586004356007810260609081526000907f24abdb5865df5079dcc5ac590ff6f01d5c16edbc5fab4e195d9febd1114503da90602090a15060070290565b5060206060f3&quot;,&quot;info&quot;:{&quot;source&quot;:&quot;contract Multiply7 { event Print(uint); function multiply(uint input) returns (uint) { Print(input * 7); return input * 7; } }&quot;,&quot;language&quot;:&quot;Solidity&quot;,&quot;languageVersion&quot;:&quot;0.2.2&quot;,&quot;compilerVersion&quot;:&quot;0.2.2&quot;,&quot;compilerOptions&quot;:&quot;--bin --abi --userdoc --devdoc --add-std --optimize -o /tmp/solc205309041&quot;,&quot;abiDefinition&quot;:[{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;input&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;multiply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;type&quot;:&quot;function&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:false,&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Print&quot;,&quot;type&quot;:&quot;event&quot;}],&quot;userDoc&quot;:{&quot;methods&quot;:{}},&quot;developerDoc&quot;:{&quot;methods&quot;:{}}}}}}
</pre></div>
</div>
<p>现在我们有了编译好的代码，我们需要确定发布它要消耗多少气。RPC接口 <code class="docutils literal"><span class="pre">eth_estimateGas</span></code> 可以给我们一个估算。</p>
<div class="code bash highlight-python"><div class="highlight"><pre>&gt; curl --data &#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;: &quot;eth_estimateGas&quot;, &quot;params&quot;: [{&quot;from&quot;: &quot;0xeb85a5557e5bdc18ee1934a89d8bb402398ee26a&quot;, &quot;data&quot;: &quot;0x6060604052605f8060106000396000f3606060405260e060020a6000350463c6888fa18114601a575b005b60586004356007810260609081526000907f24abdb5865df5079dcc5ac590ff6f01d5c16edbc5fab4e195d9febd1114503da90602090a15060070290565b5060206060f3&quot;}], &quot;id&quot;: 5}&#39; localhost:8545
{&quot;id&quot;:5,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:&quot;0xb8a9&quot;}
</pre></div>
</div>
<p>最后发布合约。</p>
<div class="code bash highlight-python"><div class="highlight"><pre>&gt; curl --data &#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;: &quot;eth_sendTransaction&quot;, &quot;params&quot;: [{&quot;from&quot;: &quot;0xeb85a5557e5bdc18ee1934a89d8bb402398ee26a&quot;, &quot;gas&quot;: &quot;0xb8a9&quot;, &quot;data&quot;: &quot;0x6060604052605f8060106000396000f3606060405260e060020a6000350463c6888fa18114601a575b005b60586004356007810260609081526000907f24abdb5865df5079dcc5ac590ff6f01d5c16edbc5fab4e195d9febd1114503da90602090a15060070290565b5060206060f3&quot;}], &quot;id&quot;: 6}&#39; localhost:8545
{&quot;id&quot;:6,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:&quot;0x3a90b5face52c4c5f30d507ccf51b0209ca628c6824d0532bcd6283df7c08a7c&quot;}
</pre></div>
</div>
<p>交易被节点接受，交易的哈希被返回。我们可以用这个哈希来追踪交易。</p>
<p>接下来是确定我们的合约的发布地址。每个交易被执行后都会有个收据。这个收据包含了一些交易信息，比如交易被包含在哪个区块、EVM消耗了多少气。如果一个交易创建了一个合约，它还会包含合约的地址。我们可以使用 <code class="docutils literal"><span class="pre">eth_getTransactionReceipt</span></code> 这个RPC方法取得收据信息。</p>
<div class="code bash highlight-python"><div class="highlight"><pre>&gt; curl --data &#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;: &quot;eth_getTransactionReceipt&quot;, &quot;params&quot;: [&quot;0x3a90b5face52c4c5f30d507ccf51b0209ca628c6824d0532bcd6283df7c08a7c&quot;], &quot;id&quot;: 7}&#39; localhost:8545
{&quot;id&quot;:7,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:{&quot;transactionHash&quot;:&quot;0x3a90b5face52c4c5f30d507ccf51b0209ca628c6824d0532bcd6283df7c08a7c&quot;,&quot;transactionIndex&quot;:&quot;0x0&quot;,&quot;blockNumber&quot;:&quot;0x4c&quot;,&quot;blockHash&quot;:&quot;0xe286656e478a1b99030e318d0f5c3a61a644f25e63deaa8be52e80da1e7b0c47&quot;,&quot;cumulativeGasUsed&quot;:&quot;0xb8a9&quot;,&quot;gasUsed&quot;:&quot;0xb8a9&quot;,&quot;contractAddress&quot;:&quot;0x6ff93b4b46b41c0c3c9baee01c255d3b4675963d&quot;,&quot;logs&quot;:[]}}
</pre></div>
</div>
<p>我们可以看到合约被创建在 <code class="docutils literal"><span class="pre">0x6ff93b4b46b41c0c3c9baee01c255d3b4675963d</span></code> 上。如果你获得了null，说明交易还没有被包含到区块上。稍等一下，检查你的矿工是否在运行，然后重试这个命令。</p>
</div>
<div class="section" id="id6">
<h2>与智能合约交互<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>现在我们的合约已经发布完成，我们可以与它开始交互了。这里有两种方法，发送一个交易，或者 <a class="reference internal" href="contracts.html#interacting-with-a-contract"><span>像先前提到的那样call</span></a> 。在此我们会向合约的multiply方法发送一个交易。</p>
<p>如果我们查看 <a class="reference external" href="https://github.com/ethereum/wiki/wiki/JSON-RPC#eth_sendtransaction">eth_sendTransaction</a> 这个文档，我们需要提供多个参数。我们需要指定 <code class="docutils literal"><span class="pre">from</span></code> 、 <code class="docutils literal"><span class="pre">to</span></code> 和 <code class="docutils literal"><span class="pre">data</span></code> 参数。<code class="docutils literal"><span class="pre">from</span></code> 是我们的账号的公共地址， <code class="docutils literal"><span class="pre">to</span></code> 是合约地址。 <code class="docutils literal"><span class="pre">data</span></code> 参数有点儿麻烦。它包含了哪些方法需要用哪些参数进行调用这样的有效信息。这里就需要ABI（Application Binary Interface）出场了。ABI是如何为EVM编码的定义。请参考 <a class="reference external" href="https://github.com/ethereum/wiki/wiki/Ethereum-Contract-ABI">ABI的所有细节</a> 。</p>
<p>这里的有效信息字节就是函数选择器，它将指定哪些方法会被调用。这是通过把对函数名称和他的参数类型的Keccak哈希值的首4字节转换为16进制达成的。 <cite>multiply</cite> 函数接受一个 <a class="reference external" href="http://solidity.readthedocs.org/en/latest/types.html#integers">等价于</a> <cite>uint256</cite> 的 <cite>uint</cite> 参数。我们可以获得：</p>
<div class="code js highlight-python"><div class="highlight"><pre>&gt; web3.sha3(&quot;multiply(uint256)&quot;).substring(0, 8)
&quot;c6888fa1&quot;
</pre></div>
</div>
<p>更多细节请参考 <a class="reference external" href="https://github.com/ethereum/wiki/wiki/Ethereum-Contract-ABI#function-selector">函数选择器</a> 。</p>
<p>下一个步骤就是对参数进行编码，我们只有一个uint256，让我们假定以6作为参数值。这个ABI文档 <a class="reference external" href="https://github.com/ethereum/wiki/wiki/Ethereum-Contract-ABI#argument-encoding">章节</a> 具体说明了如何编码成uint256类型。</p>
<blockquote>
<div><cite>int&lt;M&gt;: enc(X) is the big-endian two&#8217;s complement encoding of X, padded on the higher-oder (left) side with 0xff for negative X and with zero bytes
for positive X such that the length is a multiple of 32 bytes.</cite></div></blockquote>
<p>这样，6就应该编码为 <code class="docutils literal"><span class="pre">0000000000000000000000000000000000000000000000000000000000000006</span></code> 。</p>
<p>结合函数选择器和参数编码，我们的 <code class="docutils literal"><span class="pre">data</span></code> 应该就是 <code class="docutils literal"><span class="pre">0xc6888fa10000000000000000000000000000000000000000000000000000000000000006</span></code> 。</p>
<p>我们试一下：</p>
<div class="code bash highlight-python"><div class="highlight"><pre>&gt; curl --data &#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;: &quot;eth_sendTransaction&quot;, &quot;params&quot;: [{&quot;from&quot;: &quot;0xeb85a5557e5bdc18ee1934a89d8bb402398ee26a&quot;, &quot;to&quot;: &quot;0x6ff93b4b46b41c0c3c9baee01c255d3b4675963d&quot;, &quot;data&quot;: &quot;0xc6888fa10000000000000000000000000000000000000000000000000000000000000006&quot;}], &quot;id&quot;: 8}&#39; localhost:8545
{&quot;id&quot;:8,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:&quot;0x759cf065cbc22e9d779748dc53763854e5376eea07409e590c990eafc0869d74&quot;}
</pre></div>
</div>
<p>由于我们发送了一个交易，我们获得了交易的哈希。如果我们来获取收据，会看到一些新东西：</p>
<div class="highlight-js"><div class="highlight"><pre><span class="p">{</span>
   <span class="nx">blockHash</span><span class="o">:</span> <span class="s2">&quot;0xbf0a347307b8c63dd8c1d3d7cbdc0b463e6e7c9bf0a35be40393588242f01d55&quot;</span><span class="p">,</span>
   <span class="nx">blockNumber</span><span class="o">:</span> <span class="mi">268</span><span class="p">,</span>
   <span class="nx">contractAddress</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
   <span class="nx">cumulativeGasUsed</span><span class="o">:</span> <span class="mi">22631</span><span class="p">,</span>
   <span class="nx">gasUsed</span><span class="o">:</span> <span class="mi">22631</span><span class="p">,</span>
<span class="hll">   <span class="nx">logs</span><span class="o">:</span> <span class="p">[{</span>
</span>      <span class="nx">address</span><span class="o">:</span> <span class="s2">&quot;0x6ff93b4b46b41c0c3c9baee01c255d3b4675963d&quot;</span><span class="p">,</span>
      <span class="nx">blockHash</span><span class="o">:</span> <span class="s2">&quot;0xbf0a347307b8c63dd8c1d3d7cbdc0b463e6e7c9bf0a35be40393588242f01d55&quot;</span><span class="p">,</span>
      <span class="nx">blockNumber</span><span class="o">:</span> <span class="mi">268</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="s2">&quot;0x000000000000000000000000000000000000000000000000000000000000002a&quot;</span><span class="p">,</span>
      <span class="nx">logIndex</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">topics</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;0x24abdb5865df5079dcc5ac590ff6f01d5c16edbc5fab4e195d9febd1114503da&quot;</span><span class="p">],</span>
      <span class="nx">transactionHash</span><span class="o">:</span> <span class="s2">&quot;0x759cf065cbc22e9d779748dc53763854e5376eea07409e590c990eafc0869d74&quot;</span><span class="p">,</span>
      <span class="nx">transactionIndex</span><span class="o">:</span> <span class="mi">0</span>
  <span class="p">}],</span>
  <span class="nx">transactionHash</span><span class="o">:</span> <span class="s2">&quot;0x759cf065cbc22e9d779748dc53763854e5376eea07409e590c990eafc0869d74&quot;</span><span class="p">,</span>
  <span class="nx">transactionIndex</span><span class="o">:</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
</div>
<p>收据包含了日志。这个日志是在交易执行的时候由EVM生成并包含到收据里的。我们可以看到在multiply函数中的Print事件被触发，打印了输入数值的7倍。由于Print事件的参数是uint256类型，我们可以基于ABI规则对其解码得到我们预期的十进制数值42。虽然脱离了data，topics字段就没有意义了，但它可以用来判断是哪个事件创建了这个日志：</p>
<div class="code js highlight-python"><div class="highlight"><pre>&gt; web3.sha3(&quot;Print(uint256)&quot;)
&quot;24abdb5865df5079dcc5ac590ff6f01d5c16edbc5fab4e195d9febd1114503da&quot;
</pre></div>
</div>
<p>你可以从 <a class="reference external" href="http://solidity.readthedocs.org/en/latest/contracts.html#events">Solidity tutorial</a> 中得到更多关于events、topics和indexing相关的信息。</p>
<p>这里仅是个对最普通任务的简短介绍。请参阅 <a class="reference external" href="https://github.com/ethereum/wiki/wiki/JSON-RPC#json-rpc-methods">RPC wiki page</a> 获知全部的可用RPC方法。</p>
</div>
<div class="section" id="web3-js">
<span id="using-web3-js"></span><h2>Web3.js<a class="headerlink" href="#web3-js" title="Permalink to this headline">¶</a></h2>
<p>就像我们在先前的示例中看到的那样，使用JSON-RPC接口是单调的、容易犯错的，特别是当我们要处理ABI的时候。Web.js则是一个基于以太坊RPC接口之上的javascript库，它的目标是提供一个更友好的接口、减少出错的机会。</p>
<p>用web3发布Multiply7合约大致像这样：</p>
<div class="code js highlight-python"><div class="highlight"><pre>var source = &#39;contract Multiply7 { event Print(uint); function multiply(uint input) returns (uint) { Print(input * 7); return input * 7; } }&#39;;
var compiled = web3.eth.compile.solidity(source);
var code = compiled.Multiply7.code;
var abi = compiled.Multiply7.info.abiDefinition;

web3.eth.contract(abi).new({from: &quot;0xeb85a5557e5bdc18ee1934a89d8bb402398ee26a&quot;, data: code}, function (err, contract) {
   if (!err &amp;&amp; contract.address)
      console.log(&quot;deployed on:&quot;, contract.address);
   }
);

deployed on: 0x0ab60714033847ad7f0677cc7514db48313976e2
</pre></div>
</div>
<p>加载发布的合约并发送一个交易：</p>
<div class="code js highlight-python"><div class="highlight"><pre>var source = &#39;contract Multiply7 { event Print(uint); function multiply(uint input) returns (uint) { Print(input * 7); return input * 7; } }&#39;;
var compiled = web3.eth.compile.solidity(source);
var Multiply7 = web3.eth.contract(compiled.Multiply7.info.abiDefinition);
var multi = Multiply7.at(&quot;0x0ab60714033847ad7f0677cc7514db48313976e2&quot;)
multi.multiply.sendTransaction(6, {from: &quot;0xeb85a5557e5bdc18ee1934a89d8bb402398ee26a&quot;})
</pre></div>
</div>
<p>注册一个当 <code class="docutils literal"><span class="pre">Print</span></code> 事件创建日志之后会被调用的回调（callback）。</p>
<div class="code js highlight-python"><div class="highlight"><pre>multi.Print(function(err, data) { console.log(JSON.stringify(data)) })
{&quot;address&quot;:&quot;0x0ab60714033847ad7f0677cc7514db48313976e2&quot;,&quot;args&quot;: {&quot;&quot;:&quot;21&quot;},&quot;blockHash&quot;:&quot;0x259c7dc07c99eed9dd884dcaf3e00a81b2a1c83df2d9855ce14c464b59f0c8b3&quot;,&quot;blockNumber&quot;:539,&quot;event&quot;:&quot;Print&quot;,&quot;logIndex&quot;:0, &quot;transactionHash&quot;:&quot;0x5c115aaa5418118457e96d3c44a3b66fe9f2bead630d79455d0ecd832dc88d48&quot;,&quot;transactionIndex&quot;:0}
</pre></div>
</div>
<p>更多信息请参考 <a class="reference external" href="https://github.com/ethereum/wiki/wiki/JavaScript-API">web3.js</a> wiki页。</p>
</div>
<div class="section" id="id10">
<h2>控制台<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p>geth <a class="reference external" href="https://github.com/ethereum/go-ethereum/wiki/JavaScript-Console">控制台</a> 提供了一个javascript环境的命令行接口。它可以连接到一个本地或远程的geth或eth节点。它会加载web3.js库，使用户可以在控制台上使用web3.js与智能合约进行交互。 <a class="reference internal" href="#using-web3-js"><span>Web3.js</span></a> 这节中的样例是可以直接在命令行执行的。</p>
</div>
<div class="section" id="id12">
<h2>查看合约和交易<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<p>有很多在线的区块链浏览器可以使你查看以太坊区块链。请参考 <a class="reference internal" href="#blockchain-explorers"><span>区块链浏览器</span></a> 。</p>
<div class="section" id="blockchain-explorers">
<span id="id13"></span><h3>托管的区块链浏览器<a class="headerlink" href="#blockchain-explorers" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://www.etherchain.org/">EtherChain</a></li>
<li><a class="reference external" href="https://live.ether.camp/">EtherCamp</a></li>
<li><a class="reference external" href="http://etherscan.io/">EtherScan</a> (and for <a class="reference external" href="http://testnet.etherscan.io">Testnet</a>)</li>
</ul>
</div>
<div class="section" id="id14">
<h3>其他资源<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://ethernodes.org/">EtherNodes</a> - Geographic distribution of nodes and split by client</li>
<li><a class="reference external" href="http://www.etherlisten.com">EtherListen</a> - Realtime Ethereum transaction visualizer and audializer</li>
</ul>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mix.html" class="btn btn-neutral float-right" title="Mix" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="contracts.html" class="btn btn-neutral" title="合约" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Ethereum community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>