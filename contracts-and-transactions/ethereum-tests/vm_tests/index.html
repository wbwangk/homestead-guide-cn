

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>VM Tests &mdash; 以太坊Homestead文档 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="author" title="About these documents"
              href="../../../about.html"/>
    <link rel="top" title="以太坊Homestead文档 0.1 documentation" href="../../../index.html"/>
        <link rel="up" title="Ethereum Tests" href="../index.html"/>
        <link rel="next" title="Web3基础层服务" href="../../web3-base-layer-services.html"/>
        <link rel="prev" title="Transaction Tests" href="../transaction_tests/index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> 以太坊Homestead文档
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">引言</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ethereum-clients/index.html">以太坊客户端</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../connecting-to-clients/index.html">连接到以太坊客户端</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../account-management.html">账户管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ether.html">以太币</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../network/index.html">以太坊网络</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mining.html">挖矿</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">合约和交易</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../account-types-gas-and-transactions.html">账户类型、气和交易</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contracts.html">合约</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../accessing-contracts-and-transactions.html">访问合约和交易</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mix.html">Mix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer-tools.html">Dapps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer-tools.html#id3">开发工具</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Ethereum Tests</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../using-testeth.html">Using Testeth</a></li>
<li class="toctree-l3"><a class="reference internal" href="../blockchain_tests/index.html">Blockchain Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../state_tests/index.html">State Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rlp_tests/index.html">RLP Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../difficulty_tests/index.html">Difficulty Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../transaction_tests/index.html">Transaction Tests</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">VM Tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-structure">Basic structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sections">Sections</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../web3-base-layer-services.html">Web3基础层服务</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../frequently-asked-questions/frequently-asked-questions.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">术语表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">Homestead文档计划</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">以太坊Homestead文档</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">合约和交易</a> &raquo;</li>
      
          <li><a href="../index.html">Ethereum Tests</a> &raquo;</li>
      
    <li>VM Tests</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/contracts-and-transactions/ethereum-tests/vm_tests/index.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="vm-tests">
<span id="id1"></span><h1>VM Tests<a class="headerlink" href="#vm-tests" title="Permalink to this headline">¶</a></h1>
<p>Found in <code class="docutils literal"><span class="pre">/VMTest</span></code>, the VM tests aim is to test the basic workings of the VM in isolation. This is specifically not meant to cover transaction, creation or call processing, or management of the state trie. Indeed at least one implementation tests the VM without calling into any Trie code at all.</p>
<p>It is based around the notion of executing a single piece of code as part of a transaction, described by the <code class="docutils literal"><span class="pre">exec</span></code> portion of the test. The overarching environment in which it is executed is described by the <code class="docutils literal"><span class="pre">env</span></code> portion of the test and includes attributes of the current and previous blocks. A set of pre-existing accounts are detailed in the <code class="docutils literal"><span class="pre">pre</span></code> portion and form the world state prior to execution. Similarly, a set of accounts are detailed in the <code class="docutils literal"><span class="pre">post</span></code> portion to specify the end world state.</p>
<p>The gas remaining (<code class="docutils literal"><span class="pre">gas</span></code>), the log entries (<code class="docutils literal"><span class="pre">logs</span></code>) as well as any output returned from the code (<code class="docutils literal"><span class="pre">output</span></code>) is also detailed.</p>
<p>Because the data of the blockchain is not given, the opcode BLOCKHASH could not return the hashes of the corresponding blocks. Therefore we define the hash of block number n to be SHA3-256(&#8220;n&#8221;).</p>
<p>Since these tests are meant only as a basic test of VM operation, the <code class="docutils literal"><span class="pre">CALL</span></code> and <code class="docutils literal"><span class="pre">CREATE</span></code> instructions are not actually executed. To provide the possibility of testing to guarantee they were actually run at all, a separate portion <code class="docutils literal"><span class="pre">callcreates</span></code> details each <code class="docutils literal"><span class="pre">CALL</span></code> or <code class="docutils literal"><span class="pre">CREATE</span></code> operation in the order they would have been executed. Furthermore, gas required is simply that of the VM execution: the gas cost for transaction processing is excluded.</p>
<p>It is generally expected that the test implementer will read <code class="docutils literal"><span class="pre">env</span></code>, <code class="docutils literal"><span class="pre">exec</span></code> and <code class="docutils literal"><span class="pre">pre</span></code> then check their results against <code class="docutils literal"><span class="pre">gas</span></code>, <code class="docutils literal"><span class="pre">logs</span></code>, <code class="docutils literal"><span class="pre">out</span></code>, <code class="docutils literal"><span class="pre">post</span></code> and <code class="docutils literal"><span class="pre">callcreates</span></code>. If an exception is expected, then latter sections are absent in the test. Since the reverting of the state is not part of the VM tests.</p>
<div class="section" id="basic-structure">
<h2>Basic structure<a class="headerlink" href="#basic-structure" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>{
   &quot;test name 1&quot;: {
           &quot;env&quot;: { ... },
           &quot;pre&quot;: { ... },
           &quot;exec&quot;: { ... },
           &quot;gas&quot;: { ... },
           &quot;logs&quot;: { ... },
           &quot;out&quot;: { ... },
           &quot;post&quot;: { ... },
           &quot;callcreates&quot;: { ... }
   },
   &quot;test name 2&quot;: {
           &quot;env&quot;: { ... },
           &quot;pre&quot;: { ... },
           &quot;exec&quot;: { ... },
           &quot;gas&quot;: { ... },
           &quot;logs&quot;: { ... },
           &quot;out&quot;: { ... },
           &quot;post&quot;: { ... },
           &quot;callcreates&quot;: { ... }
   },
   ...
}
</pre></div>
</div>
</div>
<div class="section" id="sections">
<h2>Sections<a class="headerlink" href="#sections" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">env</span></code> section:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">currentCoinbase</span></code>: The current block&#8217;s coinbase address, to be returned by the <code class="docutils literal"><span class="pre">COINBASE</span></code> instruction.</li>
<li><code class="docutils literal"><span class="pre">currentDifficulty</span></code>: The current block&#8217;s difficulty, to be returned by the <code class="docutils literal"><span class="pre">DIFFICULTY</span></code> instruction.</li>
<li><code class="docutils literal"><span class="pre">currentGasLimit</span></code>: The current block&#8217;s gas limit.</li>
<li><code class="docutils literal"><span class="pre">currentNumber</span></code>: The current block&#8217;s number.</li>
<li><code class="docutils literal"><span class="pre">currentTimestamp</span></code>: The current block&#8217;s timestamp.</li>
<li><code class="docutils literal"><span class="pre">previousHash</span></code>: The previous block&#8217;s hash.</li>
</ul>
<p>The <code class="docutils literal"><span class="pre">exec</span></code> section:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">address</span></code>: The address of the account under which the code is executing, to be returned by the <code class="docutils literal"><span class="pre">ADDRESS</span></code> instruction.</li>
<li><code class="docutils literal"><span class="pre">origin</span></code>: The address of the execution&#8217;s origin, to be returned by the <code class="docutils literal"><span class="pre">ORIGIN</span></code> instruction.</li>
<li><code class="docutils literal"><span class="pre">caller</span></code>: The address of the execution&#8217;s caller, to be returned by the <code class="docutils literal"><span class="pre">CALLER</span></code> instruction.</li>
<li><code class="docutils literal"><span class="pre">value</span></code>: The value of the call (or the endowment of the create), to be returned by the <code class="docutils literal"><span class="pre">CALLVALUE</span></code> instruction.</li>
<li><code class="docutils literal"><span class="pre">data</span></code>: The input data passed to the execution, as used by the <code class="docutils literal"><span class="pre">CALLDATA</span></code>... instructions. Given as an array of byte values. See $DATA_ARRAY.</li>
<li><code class="docutils literal"><span class="pre">code</span></code>: The actual code that should be executed on the VM (not the one stored in the state(address)) . See $DATA_ARRAY.</li>
<li><code class="docutils literal"><span class="pre">gasPrice</span></code>: The price of gas for the transaction, as used by the <code class="docutils literal"><span class="pre">GASPRICE</span></code> instruction.</li>
<li><code class="docutils literal"><span class="pre">gas</span></code>: The total amount of gas available for the execution, as would be returned by the <code class="docutils literal"><span class="pre">GAS</span></code> instruction were it be executed first.</li>
</ul>
<p>The <code class="docutils literal"><span class="pre">pre</span></code> and <code class="docutils literal"><span class="pre">post</span></code> sections each have the same format of a mapping between addresses and accounts. Each account has the format:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">balance</span></code>: The balance of the account.</li>
<li><code class="docutils literal"><span class="pre">nonce</span></code>: The nonce of the account.</li>
<li><code class="docutils literal"><span class="pre">code</span></code>: The body code of the account, given as an array of byte values. See $DATA_ARRAY.</li>
<li><code class="docutils literal"><span class="pre">storage</span></code>: The account&#8217;s storage, given as a mapping of keys to values. For key used notion of string as digital or hex number e.g: <code class="docutils literal"><span class="pre">&quot;1200&quot;</span></code> or <code class="docutils literal"><span class="pre">&quot;0x04B0&quot;</span></code> For values used $DATA_ARRAY.</li>
</ul>
<p>The <code class="docutils literal"><span class="pre">callcreates</span></code> section details each <code class="docutils literal"><span class="pre">CALL</span></code> or <code class="docutils literal"><span class="pre">CREATE</span></code> instruction that has been executed. It is an array of maps with keys:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">data</span></code>: An array of bytes specifying the data with which the <code class="docutils literal"><span class="pre">CALL</span></code> or <code class="docutils literal"><span class="pre">CREATE</span></code> operation was made. In the case of <code class="docutils literal"><span class="pre">CREATE</span></code>, this would be the (initialisation) code. See $DATA_ARRAY.</li>
<li><code class="docutils literal"><span class="pre">destination</span></code>: The receipt address to which the <code class="docutils literal"><span class="pre">CALL</span></code> was made, or the null address (<code class="docutils literal"><span class="pre">&quot;0000...&quot;</span></code>) if the corresponding operation was <code class="docutils literal"><span class="pre">CREATE</span></code>.</li>
<li><code class="docutils literal"><span class="pre">gasLimit</span></code>: The amount of gas with which the operation was made.</li>
<li><code class="docutils literal"><span class="pre">value</span></code>: The value or endowment with which the operation was made.</li>
</ul>
<p>The <code class="docutils literal"><span class="pre">logs</span></code> sections is a mapping between the blooms and their corresponding logentries. Each logentry has the format:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">address</span></code>: The address of the logentry.</li>
<li><code class="docutils literal"><span class="pre">data</span></code>: The data of the logentry.</li>
<li><code class="docutils literal"><span class="pre">topics</span></code>: The topics of the logentry, given as an array of values.</li>
</ul>
<p>Finally, there are two simple keys, <code class="docutils literal"><span class="pre">gas</span></code> and <code class="docutils literal"><span class="pre">output</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">gas</span></code>: The amount of gas remaining after execution.</li>
<li><code class="docutils literal"><span class="pre">output</span></code>: The data, given as an array of bytes, returned from the execution (using the <code class="docutils literal"><span class="pre">RETURN</span></code> instruction). See $DATA_ARRAY.</li>
</ul>
<blockquote>
<div><dl class="docutils">
<dt><strong>$DATA_ARRAY</strong> - type that intended to contain raw byte data</dt>
<dd>and for convenient of the users is populated with three
types of numbers, all of them should be converted and
concatenated to a byte array for VM execution.</dd>
</dl>
</div></blockquote>
<ul>
<li><p class="first">The types are:
1. number - (unsigned 64bit)
2. &#8220;longnumber&#8221; - (any long number)
3. &#8220;0xhex_num&#8221;  - (hex format number)</p>
<blockquote>
<div><p>e.g: <code class="docutils literal"><span class="pre">````[1,</span> <span class="pre">2,</span> <span class="pre">10000,</span> <span class="pre">&quot;0xabc345dFF&quot;,</span> <span class="pre">&quot;199999999999999999999999999999999999999&quot;]````</span></code></p>
</div></blockquote>
</li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../web3-base-layer-services.html" class="btn btn-neutral float-right" title="Web3基础层服务" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../transaction_tests/index.html" class="btn btn-neutral" title="Transaction Tests" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Ethereum community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>